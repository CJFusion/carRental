<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta name="author" content="Mr. Audrian K Marak">
	<meta name="Linkedin profile" content="www.linkedin.com/in/audrian-marak-tec23">

	<!--<meta name="description " -->
	<!--content="A better place to learn computer science"> -->
	<!-- to explain about website in few words -->

	<title>Login Page</title>

	<link rel="stylesheet" type="text/css" href="assets/app.css">

	<script type="text/javascript" src="assets/app.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="flexCentered maxViewPort greyBg">
	<!-- Main Content -->
	<div class="container">
		<form id="loginForm" onsubmit="return loginAuth(event)">
			<input type="text" name="username" placeholder="Username" required>
			<input type="password" name="password" placeholder="Password" required>
			<div id="loginError">Login failed</div>
			<input type="submit" class="blueBtn" value="Login">
		</form>
		<div class="hrule vertMargins"></div>
		<div class="flexCentered">
			<button class="greenBtn" onclick="openOverlay()">Create new account</button>
		</div>
	</div>

	<!-- Overlay content -->
	<div id="overlay" class="overlay">
		<div class="overlayContent">
			<span class="closeBtn" onclick="closeOverlay()">&times;</span>
			<h3>Choose account type</h3>
			<span class="flexCentered">
				<button class="registerBtn" onclick="selAccount('customer')">Customer</button>
				<button class="registerBtn" onclick="selAccount('rentalAgency')">Rental Agency</button>
			</span>
		</div>
	</div>

	<script>
		const loginAuth = (event) => {
			event.preventDefault();

			var formData = new FormData(event.target);

			fetch('assets/login.php', {
				method: 'POST',
				body: formData,
				headers: {
					'X-Requested-With': 'fetch'
				}
			}).then(async response => {
				let res = await response.text();
				try {
					res = JSON.parse(res);
				} catch (error) {
					throw new Error('\nError parsing JSON: ' + res);
				}

				if (!response.ok) {
					if (response.status >= 400) {
						document.getElementById("loginError").style.display = 'flex';
						document.getElementById("loginError").textContent = res.message;
					}
					throw new Error("\n" + res.error + "\n" + res.message);
				}

				return res;
			}).then(data => {
				console.table(data);
				if (data.message === 'Login successful')
					window.location.href = 'home/rentCar.html';
			}).catch(error => {
				console.error('Fetch API -', error);
			});
		};


	</script>

	<style>
		#loginError {
			display: none;
			color: rgb(217, 48, 37);
			align-self: center;
			font-size: 12px;
			transform: translateY(-10px);
		}

		#loginError::before {
			content: '!';
			color: white;
			padding: 2px;
			font-family: Carlito;
			font-size: 0.8em;
			margin-right: 5px;
			width: 1.2em;
			height: 1.2em;
			border-radius: 50%;
			background-color: rgb(217, 48, 37);
			text-align: center;
		}
	</style>

</body>

</html>