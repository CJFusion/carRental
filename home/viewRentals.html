<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>View Booked Cars</title>
	<script type="text/javascript" src="https://maraks-car-rental.000webhostapp.com/assets/app.js"></script>
</head>

<body onload="displayBookedCars()">
	<h2>View Booked Cars</h2>
	<div id="bookedCarsList">
		<!-- Booked car details will be displayed here -->
	</div>
	<div id="registerError"></div>

	<style>
		#registerError,
		#passwordError {
			display: none;
			color: rgb(217, 48, 37);
			align-self: center;
			font-size: 12px;
			transform: translateY(-10px);
		}

		:is(#registerError, #passwordError)::before {
			content: '!';
			color: white;
			padding: 2px;
			font-family: Carlito;
			font-size: 0.8em;
			margin-right: 5px;
			width: 1.2em;
			height: 1.2em;
			border-radius: 50%;
			background-color: rgb(217, 48, 37);
			text-align: center;
		}
	</style>
	<script>

		const getBookingsList = async () => {

			const onFailure = (data) => {
				document.getElementById("registerError").style.display = 'flex';
				document.getElementById("registerError").textContent = data.message;
			}

			const onSuccess = (data) => {
				return data;
			}

			return await requestFetch('/api/Bookings/Agency', 'GET', {}, onFailure, onSuccess);
		}

		// Function to display booked cars and associated customers
		async function displayBookedCars() {
			let bookingsList = await getBookingsList();

			var bookedCarsListDiv = document.getElementById("bookedCarsList");
			bookedCarsListDiv.innerHTML = ""; // Clear previous content

			Object.values(bookingsList.carId).forEach(bookedCar => {

				var carDetails = document.createElement("div");
				carDetails.innerHTML = `
				<h3>${bookedCar.model}</h3>
					<ul>
					${Object.values(bookedCar)
						.filter(key => key !== bookedCar.model)
						.map(car => `
						<li>
							Customer ID: ${car.customerId},
							Name: ${car.customerName},
							Start Date: ${car.bookDate},
							End Date: ${car.endDate}
						</li>`).join('')}
					</ul>`;

				bookedCarsListDiv.appendChild(carDetails);
			});
		}
	</script>
</body>

</html>